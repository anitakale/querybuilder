(this["webpackJsonpvolume-query"]=this["webpackJsonpvolume-query"]||[]).push([[3],{1056:function(e,t){},1145:function(e,t,i){},1152:function(e,t,i){},1153:function(e,t,i){"use strict";i.r(t);var a=i(0),o=i.n(a),s=i(42),n=i.n(s),r=i(15),l=i(532),c=i(389);class AuthorizationClient_SandboxAuthorizationClient extends c.b{constructor(e){super(e),this.authConfig=void 0,this.validateConfiguration(e),this.authConfig=e}validateConfiguration(e){if(!e.clientId)throw new Error("Please add a valid OIDC client id to the .env file and restart the application. See the README for more information.");if(!e.scope)throw new Error("Please add valid scopes for your OIDC client to the .env file and restart the application. See the README for more information.");if(!e.redirectUri)throw new Error("Please add a valid redirect URI to the .env file and restart the application. See the README for more information.")}async signIn(){return c.a.handleSigninCallback(this.authConfig.redirectUri).then((async()=>super.signIn())).catch((e=>console.error(e)))}}const d=new AuthorizationClient_SandboxAuthorizationClient({scope:"imodelaccess:read imodels:read realitydata:read",clientId:"",redirectUri:"",postSignoutRedirectUri:"",responseType:"code",authority:"https://ims.bentley.com"}),u={contentManipulationTools:{cornerItem:{hideDefault:!0},hideDefaultHorizontalItems:!1,hideDefaultVerticalItems:!1,verticalItems:{sectionTools:!1,measureTools:!1,selectTool:!1},horizontalItems:{clearSelection:!1,clearHideIsolateEmphasizeElements:!1,isolateElements:!1,hideElements:!1,emphasizeElements:!1}},navigationTools:{hideDefaultHorizontalItems:!1,hideDefaultVerticalItems:!1,verticalItems:{walkView:!0,cameraView:!0},horizontalItems:{rotateView:!0,panView:!0,fitView:!0,windowArea:!0,undoView:!0,redoView:!0}},hideDefaultStatusBar:!0,hidePropertyGrid:!0,hideToolSettings:!0,hideTreeView:!0},p={BingMaps:{key:"key",value:""},MapboxImagery:{key:"access_token",value:""}};var m=i(1),g=i(3),h=i(5),w=i(2),f=i(79);const y="DRWR04-S3";class ViewSetup_ViewSetup{static async getFirstViewDefinitionId(e){const t=await e.views.queryDefaultViewId();if(m.Id64.isValid(t))return t;const i=await e.views.getViewList({from:h.SpatialViewState.classFullName});if(i.length>0)return i[0].id;const a=await e.views.getViewList({from:h.DrawingViewState.classFullName});if(a.length>0)return a[0].id;throw new Error("No valid view definitions in imodel")}static getAspectRatio(){const e=document.getElementById("sample-container");if(null!==e)return e.clientWidth/e.clientHeight}static async overrideView(e,t){const i=ViewSetup_ViewSetup.getAspectRatio();if(void 0!==i&&t.adjustAspectRatio(i),t.viewFlags=t.viewFlags.copy({shadows:!1,grid:!1,visibleEdges:!1}),t.is3d()){const i=t.getDisplayStyle3d();i.changeBackgroundMapProps({useDepthBuffer:!0});const a=await ViewSetup_ViewSetup.getGroundBias(e);if(a&&i.changeBackgroundMapProps({groundBias:a}),i.environment=g.Environment.fromJSON({sky:{display:!0,twoColor:!0,zenithColor:g.ColorDef.computeTbgrFromString("#DEF2FF"),nadirColor:g.ColorDef.computeTbgrFromString("#F0ECE8")}}),"Metrostation2"===e.name||e.name===y){const t=await ViewSetup_ViewSetup.getModelIds(e),a=await this.getSubCategoryIds(e,"S-SLAB-CONC");let o=g.PlanarClipMaskSettings.create({subCategoryIds:a,modelIds:t});o=o.clone({mode:g.PlanarClipMaskMode.IncludeSubCategories}),i.changeBackgroundMapProps({planarClipMask:o.toJSON()})}}if(t.isSpatialView()){const i=t.getDisplayStyle3d();if("Stadium"===e.name){const a=await ViewSetup_ViewSetup.getModelIds(e,"SS_MasterLandscape.dgn, LandscapeModel");i.changeBackgroundMapProps({planarClipMask:g.PlanarClipMaskSettings.create({modelIds:a}).toJSON(),transparency:.01});(await ViewSetup_ViewSetup.getModelIds(e,"SS_Master","SS_Master_Structural.dgn, 3D Metric Design","LandscapeDetails.dgn, 3D Metric Design","Stencil Model-4-LandscapeModel, SS_MasterLandscape, SS_MasterLandscape.dgn, Road_Marking")).forEach((e=>t.modelSelector.dropModels(e)))}if(e.name===y){(await ViewSetup_ViewSetup.getModelIds(e)).forEach((e=>t.modelSelector.addModels(e)));(await ViewSetup_ViewSetup.getModelIds(e,"Geotechnical Investigation, DRWR04-GEO-00-XX-M3-G-00001.dgn, 3d")).forEach((e=>t.modelSelector.dropModels(e))),t.setOrigin({x:85.69962649857428,y:-73.80364503759616,z:-82.72194576398469}),t.setExtents({x:144.70409923774804,y:150.2952419865793,z:151.43496224165358}),t.setRotation(w.J.fromJSON([-.8568887533689478,.5155013718214635,-1178475644302565e-30,-.18679591952287192,-.31050028450708866,.9320390859672258,.48046742740732745,.7986538104655898,.36235775447667495]))}}const a=await ViewSetup_ViewSetup.getShownCategories(e);a&&t.categorySelector.addCategories(a);const o=await ViewSetup_ViewSetup.getHiddenCategories(e);o&&t.categorySelector.dropCategories(o)}static async getModelIds(e){const t=new Set;if(!e.isClosed){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];const s="SELECT ECInstanceId FROM Bis:PhysicalPartition"+(a.length>0?` WHERE codeValue IN ('${a.join("','")}')`:"");for await(const i of e.query(s))t.add(i[0])}return t}static async getSubCategoryIds(e){const t=new Set;if(!e.isClosed){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];const s=`SELECT ECInstanceId as id\n                                    FROM BisCore.SubCategory\n                                    WHERE Parent.Id IN (\n                                      SELECT ECInstanceId\n                                      FROM BisCore.SpatialCategory\n                                      ${a.length>0?`WHERE CodeValue IN ('${a.join("','")}')`:""})`;for await(const i of e.query(s))t.add(i[0])}return t}}let S,C;ViewSetup_ViewSetup.getDefaultView=async e=>{const t=await ViewSetup_ViewSetup.getFirstViewDefinitionId(e),i=await e.views.load(t);return await ViewSetup_ViewSetup.overrideView(e,i),i},ViewSetup_ViewSetup.getHiddenCategories=async e=>{const t=[],addIdsByCategory=async function(){if(!e.isClosed){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];const s=`SELECT ECInstanceId FROM bis.Category WHERE CodeValue IN ('${a.join("','")}')`;for await(const i of e.query(s))t.push(i.id)}};return"house bim upload"===e.name&&await addIdsByCategory("Callouts"),"Metrostation2"!==e.name&&e.name!==y||await addIdsByCategory("A-FLOR-OTLN","A-Reserved Retail Area","G-ANNO-SYMB","A-SITE","S-BEAM-CONC"),t},ViewSetup_ViewSetup.getShownCategories=async e=>{const t=[];return e.name===y&&await(async()=>{if(!e.isClosed){const i="SELECT ECInstanceId FROM bis.Category";for await(const a of e.query(i))t.push(a.id)}})(),t},ViewSetup_ViewSetup.getGroundBias=async e=>{if(e.name===y)return 3},function(e){e.InsideTheBox="Inside",e.OutsideTheBox="Outside",e.Overlap="Overlap"}(S||(S={})),function(e){e.InsideTheBox="Inside",e.Overlap="Overlap"}(C||(C={}));class VolumeQueryApi_VolumeQueryApi{static clearClips(e){h.IModelApp.tools.run(h.ViewClipClearTool.toolId),h.ViewClipDecorationProvider.create().toggleDecoration(e)}static addDecorators(e){const t=h.ViewClipDecorationProvider.create();t.clearDecorationOnDeselect=!1,t.showDecoration(e),h.IModelApp.toolAdmin.startDefaultTool()}static clearColorOverrides(e){h.EmphasizeElements.getOrCreate(e).clearOverriddenElements(e)}static async getSpatialElementsWithName(e,t){const i=new f.a({imodel:e.iModel}),a=await i.getLabels(t);for(let o=0;o<t.length;o++)t[o].name=a[o];return t}static async getSpatialElements(e,t){const i=`SELECT e.ECInstanceId,  ec_classname(e.ECClassId, 's:c')  FROM bis.SpatialElement e JOIN bis.SpatialIndex i ON e.ECInstanceId=i.ECInstanceId WHERE i.MinX<=${t.xHigh} AND i.MinY<=${t.yHigh} AND i.MinZ<=${t.zHigh} AND i.MaxX >= ${t.xLow} AND i.MaxY >= ${t.yLow} AND i.MaxZ >= ${t.zLow}`,a=e.query(i),o=[];for await(const s of a)o.push({id:s[0],className:s[1],name:void 0});return o}static async getClassifiedElements(e,t,i){const a=e.view.getViewClip();if(void 0===a)return;const o=i.map((e=>e.id)),s={[C.InsideTheBox]:[],[C.Overlap]:[]},n={candidates:o,clip:a.toJSON(),allowOverlaps:!0,viewFlags:e.viewFlags.toJSON()},r=await t.getGeometryContainment(n);return m.BentleyStatus.SUCCESS===r.status&&void 0!==r.candidatesContainment?(r.candidatesContainment.forEach(((e,t)=>{switch(e){case w.m.StronglyInside:s[C.InsideTheBox].push(i[t]);break;case w.m.Ambiguous:s[C.Overlap].push(i[t])}})),s):void 0}static computeClipRange(e){const t=e.computeViewRange(),i=e.view.getViewClip();if(void 0!==i){const e=w.p.rangeOfClipperIntersectionWithRange(i,t);e.isNull||t.setFrom(e)}return t}static async colorClassifiedElements(e,t,i){h.EmphasizeElements.getOrCreate(e).overrideElements(t[S.InsideTheBox].map((e=>e.id)),e,i[S.InsideTheBox]),h.EmphasizeElements.getOrCreate(e).overrideElements(t[S.Overlap].map((e=>e.id)),e,i[S.Overlap]),h.EmphasizeElements.getOrCreate(e).defaultAppearance=g.FeatureAppearance.fromRgb(i[S.OutsideTheBox])}static async getIsoView(e){const t=await ViewSetup_ViewSetup.getDefaultView(e);if(t.is3d()){t.setStandardRotation(h.StandardViewId.RightIso);const e=t.computeFitRange(),i=ViewSetup_ViewSetup.getAspectRatio();t.lookAtVolume(e,i)}return t}}VolumeQueryApi_VolumeQueryApi.addBoxRange=(e,t,i)=>{void 0===t&&((t=e.view.computeFitRange()).high.z=(t.high.z+t.low.z)/2);const a=w.o.createBlock(t,t.isAlmostZeroZ?w.k.XAndY:w.k.All,!1,!1),o=w.q.createEmpty();o.appendReference(a),h.ViewClipTool.enableClipVolume(e),e.view.viewFlags=e.view.viewFlags.with("clipVolume",void 0!==i&&i),e.view.setViewClip(o),VolumeQueryApi_VolumeQueryApi.addDecorators(e)};var V=i(4),v=i(48),O=i(1218),I=i(1212),b=i(1217),E=i(1213),A=i(1214),x=i(1215),j=i(1216),M=(i(1145),i(73));const B=[{Header:"Table",columns:[{Header:"Element Id",accessor:"id",maxWidth:130},{Header:"Name",accessor:"name"}]}],VolumeQueryWidget=()=>{const e=Object(r.cb)(),t=Object(r.bb)(),[i,s]=o.a.useState(!0),[n,l]=o.a.useState(!1),[c,d]=o.a.useState({[C.InsideTheBox]:0,[C.Overlap]:0}),[u,p]=o.a.useState({[S.InsideTheBox]:g.ColorDef.green,[S.Overlap]:g.ColorDef.blue,[S.OutsideTheBox]:g.ColorDef.red}),[m,h]=o.a.useState({[C.InsideTheBox]:[],[C.Overlap]:[]}),[w,f]=o.a.useState(C.InsideTheBox),[y,V]=o.a.useState(!1);Object(a.useEffect)((()=>{e&&(i?e.view.getViewClip()||(VolumeQueryApi_VolumeQueryApi.clearColorOverrides(e),VolumeQueryApi_VolumeQueryApi.addBoxRange(e),h({[C.InsideTheBox]:[],[C.Overlap]:[]})):(VolumeQueryApi_VolumeQueryApi.clearClips(e),l(!1)))}),[e,i]),Object(a.useEffect)((()=>{if(e){const t=VolumeQueryApi_VolumeQueryApi.computeClipRange(e);n?VolumeQueryApi_VolumeQueryApi.addBoxRange(e,t,!0):VolumeQueryApi_VolumeQueryApi.addBoxRange(e,t,!1)}}),[n,e]);const D=Object(a.useCallback)((async()=>{if(e&&t){V(!0),VolumeQueryApi_VolumeQueryApi.clearColorOverrides(e),d({[C.InsideTheBox]:0,[C.Overlap]:0}),h({[C.InsideTheBox]:[],[C.Overlap]:[]});let i=[],a=[];const o=VolumeQueryApi_VolumeQueryApi.computeClipRange(e),s=await VolumeQueryApi_VolumeQueryApi.getSpatialElements(t,o);let n;const r=Math.floor(s.length/6e3);for(let l=0;l<=r;l++)n=l!==r?await VolumeQueryApi_VolumeQueryApi.getClassifiedElements(e,t,s.slice(6e3*l,6e3*(l+1))):await VolumeQueryApi_VolumeQueryApi.getClassifiedElements(e,t,s.slice(6e3*l,s.length+1)),void 0!==n&&(await VolumeQueryApi_VolumeQueryApi.colorClassifiedElements(e,n,u),i=i.concat(n.Inside),a=a.concat(n.Overlap));m[C.InsideTheBox]=await VolumeQueryApi_VolumeQueryApi.getSpatialElementsWithName(e,i.slice(0,99)),m[C.Overlap]=await VolumeQueryApi_VolumeQueryApi.getSpatialElementsWithName(e,a.slice(0,99)),d({[C.InsideTheBox]:i.length,[C.Overlap]:a.length}),h(m),V(!1)}}),[u,m,t,e]);Object(a.useEffect)((()=>{D().catch((e=>console.error(e)))}),[]);const onColorPick=(e,t)=>{const i=u;i[t]=e,p(i)},T=[{value:C.InsideTheBox,label:"Inside of volume box"},{value:C.Overlap,label:"Overlapping the volume box"}],_=Object(a.useMemo)((()=>m[w].map((e=>({id:e.id,className:e.className,name:e.name})))),[m,w]);return Object(M.jsx)("div",{className:"sample-options",children:Object(M.jsxs)("div",{className:"sample-grid",children:[Object(M.jsxs)("div",{className:"elements-grid",children:[Object(M.jsx)(O.a,{label:"Display elements:",displayStyle:"inline",size:"small",className:"elements-grid-a",value:w,onChange:f,options:T}),c[w]>0&&Object(M.jsxs)(I.a,{isMuted:!0,className:"elements-grid-c",children:["Found ",c[w]," elements",c[w]<=100?".":", showing the first 100."]}),Object(M.jsx)(b.a,{density:"extra-condensed",data:_,columns:B,isLoading:y,emptyTableContent:"No matching elements",className:"elements-grid-b"})]}),Object(M.jsxs)("div",{className:"controls-grid",children:[Object(M.jsx)(E.a,{label:"Show Volume Box",checked:i,onChange:()=>s((e=>!e)),disabled:y}),Object(M.jsx)(E.a,{label:"Clip Volume",checked:n,onChange:()=>l((e=>!e)),disabled:y||!i}),Object(M.jsxs)(A.a,{label:"Coloring for elements:",children:[Object(M.jsxs)("div",{className:"color-picker",children:[Object(M.jsx)(v.c,{initialColor:u.Inside,onColorPick:e=>onColorPick(e,S.InsideTheBox)}),Object(M.jsx)(I.a,{children:"Inside"})]}),Object(M.jsxs)("div",{className:"color-picker",children:[Object(M.jsx)(v.c,{initialColor:u.Outside,onColorPick:e=>onColorPick(e,S.OutsideTheBox)}),Object(M.jsx)(I.a,{children:"Outside"})]}),Object(M.jsxs)("div",{className:"color-picker",children:[Object(M.jsx)(v.c,{initialColor:u.Overlap,onColorPick:e=>onColorPick(e,S.Overlap)}),Object(M.jsx)(I.a,{children:"Overlapping"})]})]}),Object(M.jsxs)(A.a,{displayStyle:"inline",children:[Object(M.jsx)(x.a,{styleType:"high-visibility",className:"control-button",disabled:!i||y,onClick:D,children:"Apply"}),Object(M.jsx)(x.a,{styleType:"high-visibility",className:"control-button",disabled:y,onClick:()=>{e&&(VolumeQueryApi_VolumeQueryApi.clearColorOverrides(e),h({[C.InsideTheBox]:[],[C.Overlap]:[]}),d({[C.InsideTheBox]:0,[C.Overlap]:0}))},children:"Clear"})]})]}),Object(M.jsx)(j.a,{type:"informational",className:"instructions",children:"Use the controls to query and color spatial elements in the iModel using a volume box"})]})})};const D=[new class VolumeQueryWidget_VolumeQueryWidgetProvider{constructor(){this.id="VolumeQueryWidgetProvider"}provideWidgets(e,t,i,a){const o=[];return i===V.v.Bottom&&o.push({id:"VolumeQueryWidget",label:"Volume Query Selector",defaultState:V.P.Open,getWidgetContent:()=>Object(M.jsx)(VolumeQueryWidget,{})}),o}}],T={viewState:async e=>VolumeQueryApi_VolumeQueryApi.getIsoView(e)};r.u.onFrontstageReadyEvent.addListener((e=>{const{bottomPanel:t}=e.frontstageDef;t&&(t.size=315)}));var src_VolumeQueryApp=()=>(Object(a.useEffect)((()=>{d.signIn()}),[]),Object(M.jsx)(l.a,{iTwinId:"70d0f847-6e15-4bb8-b617-9f6d0085ee96",iModelId:"de0a3493-c310-4d57-95a4-342ef9f33ddf",authClient:d,enablePerformanceMonitors:!0,viewportOptions:T,mapLayerOptions:p,defaultUiConfig:u,uiProviders:D,theme:"dark"}));i(1152);n.a.render(Object(M.jsx)(src_VolumeQueryApp,{}),document.getElementById("root"))},373:function(e,t){},374:function(e,t){},457:function(e,t){},461:function(e,t){},597:function(e,t){},602:function(e,t){},608:function(e,t){},610:function(e,t){}},[[1153,5,6]]]);
//# sourceMappingURL=main.3c69594f.chunk.js.map